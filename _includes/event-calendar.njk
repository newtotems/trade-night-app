<!-- Timeline -->
<div>
  {% set sortedEvents = eventlist | sort(attribute='date') %}
  {% set groupedEvents = [] %}
  {% set currentDate = '' %}
  {% set currentGroup = [] %}

  {% for event in sortedEvents %}
    {% set eventDate = event.date | readableDate('yyyy-MM-dd') %}
    {% if eventDate != currentDate %}
      {% if currentGroup.length > 0 %}
        {% set groupedEvents = (groupedEvents.push({date: currentDate, events: currentGroup}), groupedEvents) %}
      {% endif %}
      {% set currentDate = eventDate %}
      {% set currentGroup = [] %}
    {% endif %}
    {% set currentGroup = (currentGroup.push(event), currentGroup) %}
  {% endfor %}

  {% if currentGroup.length > 0 %}
    {% set groupedEvents = (groupedEvents.push({date: currentDate, events: currentGroup}), groupedEvents) %}
  {% endif %}

  {% for group in groupedEvents %}
  <!-- Item -->
  <div class="group relative flex gap-x-5">
    <!-- Icon -->
    <div class="relative group-last:after:hidden after:absolute after:top-8 after:bottom-2 after:start-3 after:w-px after:-translate-x-[0.5px] after:bg-gray-200 dark:after:bg-neutral-700">
      <div class="relative z-10 flex flex-col justify-center items-center text-xs text-gray-600 dark:text-neutral-400">
        <span>{{ group.events[0].date | readableDate("ccc") | upper }}</span>
        <span>{{ group.events[0].date | readableDate("LLL") | upper }}</span>
        <span>{{ group.events[0].date | readableDate("dd") }}</span>
      </div>
    </div>
    <!-- End Icon -->

    <!-- Right Content -->
    <div class="grow pb-8 group-last:pb-0">
      <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
        {% for event in group.events %}
          {% if eventtypes %}
            {% set eventType = eventtypes | getEventType(event.eventTypeId) %}
          {% else %}
            {% set eventType = null %}
          {% endif %}
          <div class="aspect-[2/3] bg-gray-200 rounded-lg overflow-hidden relative">
            <div class="p-4">
              <h3 class="font-bold">{{ event.title }}</h3>
              <p>{{ event.location }}</p>
              <p>{{ event.date | readableDate('HH:mm') }}</p>
              {% if eventType %}
                <p class="mt-2 font-semibold">{{ eventType.name }}</p>
                <p class="text-sm">{{ eventType.description }}</p>
              {% else %}
                <p class="mt-2 text-red-500">Event type not found (ID: {{ event.eventTypeId }})</p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <!-- End Right Content -->
  </div>
  <!-- End Item -->
  {% endfor %}
</div>
<!-- End Timeline -->

<script>
  console.log('eventlist:', {{ eventlist | dump | safe }});
  console.log('eventtypes:', {{ eventtypes | dump | safe }});
  console.log('eventtypes type:', typeof {{ eventtypes | dump | safe }});
  console.log('eventtypes length:', {{ eventtypes | length }});

  // Check if eventtypes is iterable
  try {
    for (const type of {{ eventtypes | dump | safe }}) {
      console.log('Event type:', type);
    }
  } catch (error) {
    console.error('Error iterating over eventtypes:', error);
  }

  // Error logging for event types
  {% for event in eventlist %}
    {% set eventType = null %}
    {% for type in eventtypes %}
      {% if type.id == event.eventTypeId %}
        {% set eventType = type %}
      {% endif %}
    {% endfor %}
    {% if not eventType %}
      console.error('Event type not found for event:', {{ event | dump | safe }});
    {% else %}
      console.log('Matched event type for event:', {{ event.title }}, 'Type:', {{ eventType | dump | safe }});
    {% endif %}
  {% endfor %}

  // If eventtypes is empty, log more information about the context
  {% if not eventtypes %}
    console.log('Template context:', {{ this | dump | safe }});
  {% endif %}
</script>